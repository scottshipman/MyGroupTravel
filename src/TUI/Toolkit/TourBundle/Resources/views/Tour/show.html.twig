{% extends '::site-base.html.twig' %}

{% if 'en_GB' in locale %} {% set format = 'd M Y' %} {% else %} {% set format = 'M d Y' %} {% endif %}

{% block title %}
    {% if is_granted("ROLE_BRAND") %}
        Tour
    {% else %}
        {{ entity.name }}
    {% endif %}
{% endblock %}

{% block page_title %}
    <span>Dashboard</span>
{% endblock %}

{% block page_title_menu %}
    <button id="tour-title-drop" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon title-menu-drop">
        <i class="material-icons">arrow_drop_down</i>
    </button>
    {% embed "TourBundle:Tour:tourMenu.html.twig" %}
        {% if editable %}
            {% block tour_dashboard_link %}
                <li><a href="{{ path('manage_tour_show', { 'id': entity.id }) }}" class="mdl-menu__item">Tour Dashboard</a></li>
            {% endblock %}
        {% endif %}
    {% endembed %}
{% endblock %}

{% block back_link %}
    {% if is_granted("ROLE_BRAND") %}
        <a class="back-link" href="{{ path('manage_tour') }}"><i class="fa fa-arrow-left"></i> Back to the List</a>
    {% else %}
        <a class="back-link" href="/"><i class="fa fa-arrow-left"></i> Back to Dashboard</a>
    {% endif %}
{% endblock %}

{% block sub_header %}
    <div class="sub-header">
      <div class="sizer">
        <div class="inner">
              {% if entity.institution.media %}
                  <div class="institution-logo">
                      <img src="{{ asset( entity.institution.media.getRelativePath ~ "/" ~ entity.institution.media.getHashedFilename ) | imagine_filter('thumbnailLarge') }}" alt="{{ entity.institution.name }}">
                  </div>
              {% endif %}

          {% if entity.institution %}<div id="site-quote-name">{{ entity.institution.name }}</div>{% endif %}

          <h2>{{ entity.name }}{% if entity.quoteNumber %}({{ entity.quoteNumber }}){% endif %}</h2>

          {% if entity.destination %}<div>{{ entity.destination }}</div>{% endif %}
        </div>
      </div>
    </div>
{% endblock %}

{% block body -%}

    {#{{ dump(entity) }}#}
    <div class="tour-show-left-column">
        <ul class="tour-show-submenu">
            <li><strong>Tour Summary</strong></li>
            <hr>
            <li><label>Institution</label></br><strong>{{ entity.institution.name }}</strong></li>
            <hr>
            <li><label>Departure Date</label></br><strong>{{ entity.departureDate|date(format) }}</strong></li>
            <hr>
            <li><label>Number Of Passengers</label></br><strong>Some number</strong></li>
            <hr>
            <li><label>Price Per Passenger</label></br><strong>{% if entity.currency %}{{ entity.currency.htmlSymbol | raw }}{% endif %}{{ entity.pricePersonPublic }}</strong></li>
            <hr>
        </ul>

        <div class="tour-edit-organizer-left">
            <label>Organizers</label>
            {% if entity.organizer.media %}
                <img class="tui-image-avatar" src="{{ asset( entity.organizer.media.getRelativePath ~ "/" ~ entity.organizer.media.getHashedFilename ) | imagine_filter('thumbnail') }}" alt="{{ entity.organizer.username }}">
            {% elseif entity.organizer.firstName and entity.organizer.lastName %}
                <span class="tui-text-avatar mdl-typography--headline">{{ entity.organizer.firstName[:1] }}{{ entity.organizer.lastName[:1] }}</span>
            {% else %}
                <span class="tui-text-avatar mdl-typography--headline">{{ entity.organizer.username[:1] }}</span>
            {% endif %}
            <a class="add-organizer" href="#"><i class="fa fa-plus-circle fa-3x"></i></a>
        </div>
    </div>

    </br>
    <div class="tour-show-right-column">

    {% if entity.SetupComplete == true and entity.isComplete == true %}

        {{ render(controller('TourBundle:Tour:getTourCompletedAndSetup', { 'id': entity.id } )) }}

    {% elseif entity.SetupComplete == true and entity.isComplete == false %}

        {{ render(controller('TourBundle:Tour:getTourNotCompletedAndSetup', { 'id': entity.id } )) }}


    {% elseif entity.SetupComplete == false %}

        {{ render(controller('TourBundle:Tour:getTourNotSetup', { 'id': entity.id } )) }}

    {% endif %}

    </div>
    <div style="clear:both;"></div>

<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.2.0/ZeroClipboard.js">
</script>
<script>
    $(document).ready(function () {
        // Promote Popup
        $(document).on('click', '#promote-tour', function (e) {
            e.preventDefault();
            var shareValue = "{{ url('tour_site_show', { 'id': entity.id, 'quoteNumber' : entity.quoteNumber }) }}";
            $("#dialog").html('<h3>Share this Tour with others</h3>' +
                    '<div><p>To send this tour to others, copy the URL below.</p></div>' +
                    '<div class="input"><input style="width:70%; padding:.25em; margin:1em;" type="text" id="share_url" name="share_url" value="' + shareValue + '" readonly="readonly">' +
                    '<a href="#" id="copy-button" data-clipboard-target="share_url"' +
                    'title="Click to copy Tour URL"' +
                    'class="not-full mdl-button mdl-js-button mdl-button--raised mdl-button--colored">' +
                    '<i class="fa fa-sign-in fa-stack"></i>' +
                    '</a></div>'
            );
            $("#dialog").dialog({width: '30%', height: '200'}).dialog("option", "title", "Promote the Tour").dialog("open");
            // Copy to Clipboard
            ZeroClipboard.config({swfPath: "//cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.2.0/ZeroClipboard.swf"});
            var client = new ZeroClipboard(document.getElementById("copy-button"));
            client.on('aftercopy', function (event) {
                $('#copy-button').css('background-color', 'green');
            });
            //remove the CopytoClipboard button if not Flash
            if (navigator.mimeTypes["application/x-shockwave-flash"] == undefined) {
                $("#copy-button").addClass('hidden');
                $('share_url').css('width', '80%');
            }
            doMDL_popup('.input');

        });
    });
</script>

{% endblock %}


{% block footer_left %}
    {% if entity.organizer %}
        <span class="intro">Tour Organizer:</span>
        {% if entity.organizer.media %}
            <span class="tui-image-avatar"><img src="{{ asset( entity.organizer.media.getRelativePath ~ "/" ~ entity.organizer.media.getHashedFilename ) | imagine_filter('thumbnail') }}" alt="{{ entity.organizer.username }}"></span>
        {% elseif entity.organizer.firstName and entity.organizer.lastName %}
            <span class="tui-text-avatar mdl-typography--headline">{{ entity.organizer.firstName[:1] }}{{ entity.organizer.lastName[:1] }}</span>
        {% else %}
            <span class="tui-text-avatar mdl-typography--headline">{{ entity.organizer.username[:1] }}</span>
        {% endif %}
        <span class="agent">{{ entity.organizer.firstName }} {{ entity.organizer.lastName }}<br>
        {{ entity.organizer.email }}</span>
    {% endif %}
{% endblock %}

{% block footer_right %}
    <div class="quote-info"><span class="quote-label">Price per person:</span><span class="quote-price">{% if entity.pricePerson %}<strong>{% if entity.currency %}{{ entity.currency.htmlSymbol | raw }}{% endif %}{{ entity.pricePerson }}</strong>{% endif %}</span></div>
What goes here????
{% endblock %}
