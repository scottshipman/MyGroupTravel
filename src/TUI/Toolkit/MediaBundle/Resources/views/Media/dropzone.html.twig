{% block dropzone %}
<form enctype="multipart/form-data" class="dropzone" action="{{ oneup_uploader_endpoint(context) }}" method="post"
      name="dropzone_form" id="dropzone_form">
    {{ form_widget(form) }}
    {{ form_end(form) }}
    {% endblock %}

    <script type="text/javascript">
        $(function () {
            Dropzone.options.dropzoneForm = {
                maxFiles: 1,
                acceptedMimeTypes: 'image/jpeg,image/png,image/jpg',
                addRemoveLinks: true,
                init: function () {
                    this.hiddenFileInput.removeAttribute('multiple');
                    this.on("success", function (file, response) {
                        console.log('completed dropzone');
                        console.log(file);
//                        file.serverId = response;
                        if ("#tui_toolkit_userbundle_user_media".length > 0) {
                            $("#tui_toolkit_userbundle_user_media").val(file.name);
                        }
                        if ("#tui_toolkit_brandbundle_brand_media".length > 0) {
                            $("#tui_toolkit_brandbundle_brand_media").val(file.name);
                        }
                        if ("#tui_toolkit_institutionbundle_institution_media".length > 0) {
                            $("#tui_toolkit_institutionbundle_institution_media").val(file.name);
                        }
                    });

                    this.on("error", function (file, response) {
                        alert(response);
                    });
                    this.on("addedfile", function () {
                        if (this.files[1] != null) {
                            this.removeFile(this.files[0]);
                        }
                    });
                    {#this.on("removedfile", function (file) {#}
                        {#console.log(file.serverId);#}
                        {#var name = {file: file.name}#}
                        {#$.ajax({#}
                            {#type: 'DELETE',#}
                            {#url: '{{ oneup_uploader_cancel(context) }}',#}
                            {#contentType: 'application/json',#}
                            {#data: JSON.stringify(name),#}
                            {#dataType: 'json',#}
                            {#success: function (e) {#}
                                {#console.log(e);#}
                            {#}#}
                        {#});#}
                        {#var _ref;#}
                        {#return (_ref = file) != null ? _ref.parentNode.removeChild(file.previewElement) : void 0;#}

                    {#});#}
                }
            }
        });


    </script>