{% if 'en_GB' in locale %} {% set format = 'd M Y' %} {% else %} {% set format = 'M d Y' %} {% endif %}

<div class="waitlist tour-edit mdl-card mdl-shadow--2dp">
    <div class="mdl-card__title">
        <h3 class="mdl-card__title-text">{% trans %}passenger.labels.payments{% endtrans %}</h3>

          {# only if an organizer or brand #}
        {% if 0==0 %}
                <button id="payment-actions-menu-drop-{{ passenger.id }}" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon title-button">
                    <i class="material-icons">more_vert</i>
                </button>
            <a href="#"><i id="passenger-close" style="display: none;" class="material-icons" passenger="{{ passenger.id }}">close</i></a>
            {% embed "PaymentBundle:Payment:paymentSubMenu.html.twig" %}{% endembed %}

        {% endif %}
        <div class="clear"></div>
    </div>
        {% if paymentTasks is not empty %}
            {% set overdue = 0 %}
                {% for paymentTask in paymentTasks %}
                    {% set overdue = overdue + paymentTask.overdueAmt %}
                        {%  set color = 'blue' %}{%  set icon = 'event' %}
                        {% if paymentTask.status == "paid" %}{%  set color = 'green' %}{%  set icon = 'done' %} {% endif %}
                        {% if paymentTask.status ==  "overdue" %}{%  set color = 'red' %}{%  set icon = 'warning' %}{% endif %}

                {#<div class="mdl-card__supporting-text mdl-card--border">#}
                    {#<label class="row-label">{{ paymentTask.item.name }} Paid</label>#}
                    {#<p class="row-content">{{ currency.htmlSymbol | raw  }}{{ paymentTask.credit }}</p>#}
                {#</div>#}
                {#<div class="mdl-card__supporting-text mdl-card--border">#}
                    {#<label class="row-label">{{ paymentTask.item.name }} Owed</label>#}
                    {#<p class="row-content">{{ currency.htmlSymbol | raw  }}{{ paymentTask.item.value }}</p>#}
                {#</div>#}
                <div class="mdl-card__supporting-text mdl-card--border">
                      <i style="color:{{ color }};" class="material-icons" >{{ icon }}</i>
                      <p class="mdl-card__title-text task-title" style="font-weight: 500;">{{ paymentTask.item.name }}</p>
                     <label class="task-due-date"> due by {{ paymentTask.item.dueDate | date(format) }}</label>
                     <p class="row-content" style="font-weight: 500; margin-left:3px;"> {{ currency.htmlSymbol | raw  }}{{ paymentTask.item.value }}</p>
                     <p class="row-content">{{ currency.htmlSymbol | raw  }}{{ paymentTask.credit }} of</p>
                      {#<label>{{ paymentTask.item.name }}</label> due <span class="payment-date">{{ paymentTask.item.dueDate | date(format) }}</span> {{ currency.htmlSymbol | raw  }}{{ paymentTask.credit }} paid of {{ currency.htmlSymbol | raw  }}{{ paymentTask.item.value }}#}
                </div>
                {% endfor %}

        {% endif %}
        <div class="mdl-card__supporting-text mdl-card--border">
            <label class="row-label">Total Paid</label>
            <p class="row-content" style="color:green;">{{ currency.htmlSymbol | raw  }}{{ payments.total }}</p>
        </div>
        <div class="mdl-card__supporting-text mdl-card--border">
            <label class="row-label">Total Due</label>
            <p class="row-content" style="color:blue;">{{ currency.htmlSymbol | raw  }}{{ due.total }}</p>
        </div>
        {% if overdue > 0 %}
            <div class="mdl-card__supporting-text mdl-card--border">
                <label class="row-label">Past Due</label>
                <p class="row-content" style="color:red;">{{ currency.htmlSymbol | raw  }}{{ overdue }}</p>
            </div>
        {% endif %}
        {#<p><span>{{ currency.htmlSymbol | raw  }}{{ payments.total }}</span> total paid of <span>{{ currency.htmlSymbol | raw  }}{{ due.total }}</span> total due.#}
        {% if payments.total >0  %}
            <span id="payment-history-link" style="text-align: center;"><a href="" id="toggle-payment-history" class="payment-history-link">Payment History <br /><i class="material-icons">expand_more</i></a></span>
            <div style="display:none;" id="payment-history">
                <div class="mdl-card__title">
                    <h3 class="mdl-card__title-text">Payment History</h3>
                </div>
                {% for paid in payments.items %}
                <div class="mdl-card__supporting-text mdl-card--border">
                    <p class="mdl-card__title-text task-title" style="font-weight: 500;">{{ currency.htmlSymbol | raw  }}{{ paid.value }}</p>
                    <label class="task-due-date"> on {{ paid.date | date(format)}} {% if paid.note is not empty %}- {{ paid.note }} {% endif %}</label>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
<script>
    $(document).ready(function () {

            // Payment popup
            $(document).on('click', 'a.make-a-payment', function (e) {
            var t = $(this);
            e.preventDefault();
            var passengerId = t.attr('passenger');
            var tourId = t.attr('tour');
            //$("#loader").css("display", "block");
            toolkitStandardPopup("Log A Payment", '/payment/tour/' + tourId + '/passenger/' + passengerId + '/new' );
            });

            // Customize a passenger's payment schedule
            $(document).on('click', 'a.edit-payment-schedule', function (e) {
                var t = $(this);
                e.preventDefault();
                var passengerId = t.attr('passenger');
                var tourId = t.attr('tour');
                //$("#loader").css("display", "block");
                toolkitStandardPopup("Customize {{ passenger.fname }}'s Payment Schedule", '/payment/tour/' + tourId + '/passenger/' + passengerId + '/customize' );
            });


            // toggle payment history
            $(document).on('click', 'a.payment-history-link', function(e){
                e.preventDefault();
                $('#payment-history').toggle(400, function(){
                    console.log($('#toggle-payment-history').text());
                    if ($('#toggle-payment-history').text()=='Payment History expand_more') {
                        $('#toggle-payment-history').html('Payment History <br /><i class="material-icons">expand_less</i>');
                        console.log($('#toggle-payment-history').html());
                    } else {
                        $('#toggle-payment-history').html('Payment History <br /><i class="material-icons">expand_more</i>');
                    }
                });
            });

    });
</script>