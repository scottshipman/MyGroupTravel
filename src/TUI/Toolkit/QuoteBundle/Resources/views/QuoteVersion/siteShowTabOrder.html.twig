<div class="tab-reorder-modal">
    <div id="content-blocks-wrapper" class="content-blocks-wrapper sortable-tabs">
        {% for tab, data in entity.content %}
            <div id="{{ tab }}" class="content-blocks-tab">
            <span class="content-blocks tab-label">
                <i class="content-block-tab-handle fa fa-arrows"></i>
                <h4 id="tab-label-{{ tab }}" class="editable-tab">{{ data[0] }}</h4>
            </span>


                <div id="tabs-drawer-{{ tab }}" class="sortable-items content-blocks-drawer">
                    {% for item in data[1] %}
                        <div id="content-blocks-{{ item }}" class="content-blocks content-blocks-item">
                            <i class="fa fa-arrows"></i> {{ items[item].title }}
                            {# probably render a controller here by passing in item as id and have block entity returned #}
                            <div id="content-block-actions-{{ item }}" class="content-block-actions">
                                <i class="item-edit content-block-item-action fa fa-pencil-square-o"></i>
                                <i class="item-delete content-block-item-action fa fa-trash-o"></i>
                                {% if items[item].locked %}<i
                                        class="item-lock content-block-item-action fa fa-unlock"></i> {% else %}  <i
                                        class="item-lock content-block-item-action fa fa-lock"></i> {% endif %}
                                {% if items[item].hidden %}<i
                                        class="item-hide content-block-item-action fa fa-ban"></i> {% else %} <i
                                        class="item-hide content-block-item-action fa fa-eye"></i> {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
    <div class="submit-button-container">
        <a id ="update-tabs" class="reorder-button" href="#">Submit</a>
        <a id="close-dialog" class="reorder-button" href="#">Cancel</a>
    </div>
</div>

<div id="loader"><img src="{{ asset('bundles/quote/images/loader.gif') }}"></div>

<script>
    $(document).ready(function () {

        var pathArray = '';

        $(".sortable-tabs").sortable({
            containment: "parent",
            items: "> div",
            // handle: ".move",
            tolerance: "pointer",
            cursor: "move",
            opacity: 0.7,
            revert: 300,
            delay: 150,
            dropOnEmpty: true,
            placeholder: "tabs-placeholder",
            start: function (e, ui) {
                ui.placeholder.height(ui.helper.outerHeight());
            },
            axis: 'y'

        });


        //update tab positions on click event
        $("#update-tabs").on('click', function (e) {
            e.preventDefault();
            var pathArray = window.location.pathname.split('/');
            contentBlocksUpdate(pathArray[3]);// fourth [3] part in the path should be quote ID to pass in
        });

        //close dialog box
        $('#close-dialog').click(function () {
            window.parent.jQuery('#dialog').dialog('close');
        });



        // change a tab's name
        $('.editable-tab').editable(function (value, settings) {
            //strip special chars before accepting
            //value = value.replace(/[^\w\s]/gi, '');
            return (value);
        }, {
            width: '20em',
            onblur: "cancel",
            tooltip: 'Click to edit',
            callback: function (value, settings) {
                contentBlocksUpdate({{ entity.id }}); //value
            }
        });
    })
    ;
</script>
