{% extends '::base.html.twig' %}

{% block body -%}
    <h1>ContentBlock creation</h1>

    <div id="avatar-label" class="mdl-label-mimic">Some Media
        <div style="display:none;" id="dropzone-form-close"><i class="fa fa-times-circle"></i></div>
    </div>
    {{ render(controller('MediaBundle:Media:createDropzoneForm', {'context':'contentblock'})) }}
    {{ form_start(form) }}

        <ul class="record_actions">
    <li>
        <a href="{{ path('manage_contentblocks') }}">
            <i class="fa fa-arrow-circle-left"></i> Back to the list
        </a>
    </li>
</ul>

    <div id="user_media" class="is-dirty mdl-textfield--floating-label">
        {% if entity.media %}
            <div class="media-placeholder-image">
                <div id="overlay">
                    <i class="fa fa-pencil-square-o fa-2x"></i>
                </div>
            </div>
            <script>
                $(function () {
                    Dropzone.options.dropzoneForm = {
                        maxFiles: 6,
                        acceptedMimeTypes: 'image/jpeg,image/png,image/jpg',
                        addRemoveLinks: true,
                        dictDefaultMessage: "Drop files here,<br /> or click to upload",
                        init: function () {
//                            this.hiddenFileInput.removeAttribute('multiple');
                            var values = [];
                            this.on("success", function (file, response) {
                                console.log(response.id);
                                if (".media-placeholder".length > 0) {
                                    values.push(response.id);
                                    console.log(values);
                                    $(".media-placeholder").val(values);
                                }
                            });

                            this.on("error", function (file, response) {
                                alert(response);
                            });
//                            this.on("addedfile", function () {
//                                $("#dropzone-form-close").css({"display": "none"});
//                                if (this.files[1] != null) {
//                                    this.removeFile(this.files[0]);
//
//                                }
//                            });
                            this.on("removedfile", function (file) {
                                $("#dropzone-form-close").css({"display": "inline-block"});
                                console.log(file.serverId);
                            });
                        }
                    }
                });

                {#$(document).ready(function () {#}
                {#var bUrl = '{{ asset(".." ~ entity.media.getRelativePath ~ "/" ~ entity.media.getHashedFilename ) }}';#}
                {#$(".media-placeholder-image").css({#}
                {#"background-image": "url(" + bUrl + ")",#}
                {#"background-position": "left",#}
                {#"background-repeat": "no-repeat",#}
                {#"background-size":"contain",#}
                {#"width": "auto",#}
                {#"max-width": "500px",#}
                {#"height": "auto"#}
                {#});#}
                {#});#}
            </script>
        {% else %}
            <span class="fa-stack fa-3x">
                <i class="media-placeholder-image fa fa-picture-o fa-stack-5x">
                    <span style="display:block; font-size: .25em;">click to edit</span>
                </i>
            </span>
        {% endif %}
    </div>
    {{ form_widget(form) }}
    {{ form_end(form) }}

    <ul class="record_actions">
        <li>
            <a href="{{ path('manage_contentblocks') }}">
                Back to the list
            </a>
        </li>
    </ul>
{% endblock %}
